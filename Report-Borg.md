## borg

### 简介

Borg是Google公司的集群管理器，它同时管理着很多个应用集群，每个集群都有成千上万台机器，这些集群之上运行着Google的很多不同的应用。Borg通过准入控制，高效的任务打包，超额的资源分配和进程级隔离的机器共享，来实现超高的资源利用率；通过最小化故障恢复时间的运行时特性和减少相关运行时故障的调度策略来支持高可用的应用程序；通过提供一个作业声明的标准语言，命名服务的集成机制，实时的作业监控，以及一套分析和模拟系统行为的工具来简化用户的使用。

### 特性

- 高性能，高可用性，高可靠性
	- Borg同时管理数个规模达到上万台机器的集群，其性能非常强大。
	- Borg的用户是运行Google应用和服务的Google开发人员和系统管理员，Google内部的各种工作都经由它进行管理，能够保证最大弹性和完整性情况下以大规模运行。
- 调度与资源分配
	- 调度包含可行性检查（用于找到任务可以运行的机器），以及评分（用于挑选一个可行的机器），评分标准由内置标准与用户偏好决定。
	- Borg alloc（分配的简称）是可以运行一个或多个任务的机器上的一组保留资源;无论资源是否被使用仍然被分配。Alloc可以用于为将来的任务设置资源，在停止和重启任务之间保留资源，以及将不同作业中的任务收集到同一台机器上。
	- 每个作业都有一个优先级，资源不足时高优先级任务可以以牺牲低优先级任务为代价而获得资源，。Borg将不同种类的作业分为不同的领域，并给每个领域定义了不重叠的优先权重。
- 命名和监控
	- Borg将为每个任务创建一个稳定的“Borg name service”（BNS）名称，其中包含单元名称，作业名称和任务编号。
	- 几乎在Borg下运行的每个任务都包含一个内置的HTTP服务器，它发布有关任务运行状况的信息和成千上万个性能指标。
	- 用户通过Sigma服务用户可以检查所有作业，特定单元的状态，或向下钻取到单个作业和任务，以检查其资源行为，详细日志，执行历史 ，和最终的结果。
- 可扩展性
	- 分数缓存：评估可行性和评价机器是昂贵的，因此Borg缓存分数直到机器或任务的属性改变。
	- 等价类：Borg作业中的任务通常具有相同的需求和约束，因此并不是确定每个机器上的每个挂起任务的可行性，并对所有可行的机器进行评分，Borg只对每个等价类的一个任务进行可行性分析和评分。
	- 轻松随机化：调度程序以随机顺序检查机器，直到找到“足够”可行的机器进行评分，然后选择该集合中的最佳机器。 这减少了任务进入和离开系统时所需的评分和高速缓存失效的数量，并加快了任务到机器的分配。

### 优缺点

- 优点
	- 能够有效地在数万台机器上运行工作负载。
	- 隐藏资源管理和故障处理的细节，因此其用户可以专注于应用程序开发。
	- 提供高可靠性和高可用性操作，支持的应用也是如此。
	 
- 缺点
	- 作为任务的唯一分组机制，作业是限制性的。 Borg没有一流的方式来管理整个多作业服务作为一个单一的实体，或指的是服务的相关实例。
	- 每个机器一个IP地址使事情复杂化。
	- 针对高级用户进行优化，牺牲了休闲用户。

### 评价

- 作为Google公司内使用的集群管理系统，Borg的性能和设计使它能很好地适应大公司的工作需求，其设计中也不乏对下一代集群管理系统的启发。
- Borg在迎合Google内部需求的同时，自身的高性能与设计上的限制使它并不适合小企业、小团队与个人等类型的用户。在这一方面，Borg的意义更多地在于帮助Google工程师积累经验并在Kubernete中做出相应的改进。

### 参考资料

[深度译文｜Google的大规模集群管理系统Borg](https://blog.csdn.net/karamos/article/details/80128781)