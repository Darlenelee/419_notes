# Report 1

> Requirements:
>
> Technical report about Borg, Omega, Apollo, Sigma, Kubernetes
>
> - characteristics
> - pros&cons
> - comment

## Sigma

### 简述

Sigma是阿里巴巴公司的在线任务调度器，与之相对的还有离线任务调度器Fuxi。Sigma可以抢占资源，分配资源给在线任务。任务部署使用PouchContainer。

### 特性

- 混合部署  
  - 把集群混合起来，将不同类型的任务调度到相同的物理资源上，通过调度，资源隔离等控制手段, 保障SLO（服务水平目标），极大降低成本。
  - 阿里是通过Sigma与Fuxi共同作用实现的混部，它们之间则通过一个叫做“level 0”的层去协调，一般来说，在线任务延时敏感，不可重入，在资源优先级上都比较高，可以抢占离线任务的资源。
  - 在slave节点上同时存在Sigma Agent，Fuxi Agent，Level0-Agent，接受多种调度方式。

- 富容器Pouch
  - PouchContainer是Sigma调度的对象，它也具有相当多的特性，下面列出了一些其他容器没有的特性。
    - 兼容OCI标准。
    - 支持Kubernates API。
    - 支持磁盘空间隔离，网络带宽隔离。
    - p2p镜像分发
    - 支持相当多的内核版本（是因为阿里内部有很多较老的系统，版本无法更新，必须兼容那些程序）
    - 内核补丁、lxcfs实现的资源可见性控制。

- 弹性调度和资源分时复用
  - 因为在线任务的需求和时间是有关系的，在1:00-7:00间在线任务较少，此时可以增加离线任务的资源分配。
  - 这个做法需要较准确的预测压力，扩容缩容要稳定快速。

### 优缺点

我认为一些架构是设计者根据需要作出的选择，单纯看Sigma一个方案，不太好说有什么优缺点，所以我会用一些比较来说明。另外还会有一些共同的，等待解决的问题。

- Kubernetes
  - K8s较为新颖，未经过太多实践验证，可调度节点数在一万以下。Sigma掌控节点数可达数十万级别。
  - K8s开源，参与贡献者多。Sigma闭源。
  - K8s对资源的抽象统一，有很多可供扩展、重制的部分，更多像一个框架，而不是一个成熟完整的解决方案。
- Borg
  - Borg也支持混部，并且资源利用率要高于Sigma。
  - Sigma和Fuxi结合的做法不算好方案，以后应该会统一调度，这样就和Borg相似。
  - Borg能支持十万级别以上的节点数。
  - Borg有资源隔离，效果也类似容器，但概念上不如现在的容器这样健全，比如没有镜像。功能上也比不上Pouch。
- Mesos
  - Mesos支持十万级别节点的调度方案。
  - 两层调度，支持多种调度框架。
  - Mesos的隔离性要差很多，引入了Docker后要好一点，但还是比不上Pouch。
- 难题
  - 谷歌工程师在 [Borg,Omega, and Kubernetes：Lessons learned from three container-management systems over a decade](https://queue.acm.org/detail.cfm?id=2898444) 中提出了一些问题。
  - 配置。不论是关于容器的配置还是应用程序的配置，一个可靠的配置管理并不容易。
  - 依赖条件管理，即不仅管理部署的应用，还能管理与它相关联的应用，比如监控、存储。
  - 并未听说Sigma有解决这些问题。

### 评价

- Sigma是一个优秀的项目，它帮助阿里实现了容器化迁移，提升资源利用率（日均cpu利用率从10%变为40%），节约了成本。

- Sigma始终是一个闭源的项目，我觉得它应该对标谷歌的Borg，但现在谷歌已经到了下一代项目kubernetes。听说阿里也会积极参与，最终应该会有一个更好的解决方案，在线离线统一调度将会进一步加强资源利用。

## Omega

### 简述

Omega是谷歌第三代集群管理系统，集群管理系统经历了从中央式调度器到双层调度器再到共享状态调度器的过程。论文中没有讲设计，但介绍了三代系统及其优缺点。性能的实验是通过模拟器运行的。

### 特性

1. （monolithic）全部在一个进程完成
2. （two-level）为了解决前代的静态分配
3. （shared-state）基于共享状态的调度；简化成持久化状态和验证；资源使用是乐观的

### 优缺点

1. 缺点：规模不易扩展，job的种类不同难以改变策略

2. 优点：解决了静态分配，考虑了map reduce任务的问题，引入了两集调度，公平

   缺点：不能预测job的长度（工作量）

3. 优点：增加了并行程度，利用率，全无策略避免资源长时间闲置

   缺点：job可能独占资源、低优先级不能执行

### 评价

 omega解决了mesos中framework无法了解全局资源状态从而无法优化的问题，大大提高了并发性。